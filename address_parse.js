//const streetNames = 'allee|alley|ally|aly|anex|annex|annx|anx|arc|arcade|av|ave|aven|avenu|avenue|avn|avnue|bayoo|bayou|bch|beach|bend|bg|bgs|blf|blfs|bluf|bluff|bluffs|blvd|bnd|bot|bottm|bottom|boul|boulevard|boulv|br|branch|brdge|brg|bridge|brk|brks|brnch|brook|brooks|btm|burg|burgs|byp|bypa|bypas|bypass|byps|byu|camp|canyn|canyon|cape|causeway|causwa|causway|cen|cent|center|centers|centr|centre|cir|circ|circl|circle|circles|cirs|ck|clb|clf|clfs|cliff|cliffs|club|cmn|cmns|cmp|cnter|cntr|cnyn|common|commons|cor|corner|corners|cors|course|court|courts|cove|coves|cp|cpe|cr|crcl|crcle|crecent|creek|cres|crescent|cresent|crest|crk|crossing|crossroad|crossroads|crscnt|crse|crsent|crsnt|crssing|crssng|crst|crt|cswy|ct|ctr|ctrs|cts|curv|curve|cv|cvs|cyn|dale|dam|div|divide|dl|dm|dr|driv|drive|drives|drs|drv|dv|dvd|est|estate|estates|ests|exp|expr|express|expressway|expw|expy|ext|extension|extensions|extn|extnsn|exts|fall|fall|falls|ferry|field|fields|fl|flat|flats|fld|flds|floor|fls|flt|flts|ford|fords|forest|forests|forg|forge|forges|fork|forks|fort|frd|frds|freeway|freewy|frg|frgs|frk|frks|frry|frst|frt|frway|frwy|fry|ft|fwy|garden|gardens|gardn|gateway|gatewy|gatway|gdn|gdns|glen|glens|gln|glns|grden|grdn|grdns|green|greens|grn|grns|grov|grove|groves|grv|grvs|gtway|gtwy|harb|harbor|harbors|harbr|haven|havn|hbr|hbrs|height|heights|hgts|highway|highwy|hill|hills|hiway|hiwy|hl|hllw|hls|hollow|hollows|holw|holws|hrbor|ht|hts|hvn|hway|hwy|inlet|inlt|is|island|islands|isle|isles|islnd|islnds|iss|jct|jction|jctn|jctns|jcts|junction|junctions|junctn|juncton|key|keys|knl|knls|knol|knoll|knolls|ky|kys|la|lake|lakes|land|land|landing|lane|lanes|lck|lcks|ldg|ldge|lf|lgt|lgts|light|lights|lk|lks|ln|lndg|lndng|loaf|lock|locks|lodg|lodge|loop|loops|mall|mall|manor|manors|mdw|mdws|meadow|meadows|medows|mews|mews|mill|mills|mission|missn|ml|mls|mnr|mnrs|mnt|mntain|mntn|mntns|motorway|mount|mountain|mountains|mountin|msn|mssn|mt|mtin|mtn|mtns|mtwy|nck|neck|opas|orch|orchard|orchrd|oval|overpass|ovl|park|parks|parkway|parkways|parkwy|pass|pass|passage|path|paths|pike|pikes|pine|pines|pk|pkway|pkwy|pkwys|pky|pl|place|plain|plaines|plains|plaza|pln|plns|plz|plza|pne|pnes|point|points|port|ports|pr|prairie|prarie|prk|prr|prt|prts|psge|pt|pts|rad|radial|radiel|radl|ranch|ranches|rapid|rapids|rd|rdg|rdge|rdgs|rds|rest|ridge|ridges|riv|river|rivr|rnch|rnchs|road|roads|route|row|row|rpd|rpds|rst|rte|rue|rue|run|run|rvr|shl|shls|shoal|shoals|shoar|shoars|shore|shores|shr|shrs|skwy|skyway|smt|spg|spgs|spng|spngs|spring|springs|sprng|sprngs|spur|spurs|sq|sqr|sqre|sqrs|sqs|squ|square|squares|st|sta|station|statn|stn|str|stra|strav|strave|straven|stravenue|stravn|stream|street|streets|streme|strm|strt|strvn|strvnue|sts|sumit|sumitt|summit|ter|terr|terrace|throughway|tpk|tpke|tr|trace|traces|track|tracks|trafficway|trail|trails|trak|trce|trfy|trk|trks|trl|trls|trnpk|trpk|trwy|tunel|tunl|tunls|tunnel|tunnels|tunnl|turnpike|turnpk|un|underpass|union|unions|uns|upas|valley|valleys|vally|vdct|via|viadct|viaduct|view|views|vill|villag|village|villages|ville|villg|villiage|vis|vist|vista|vl|vlg|vlgs|vlly|vly|vlys|vst|vsta|vw|vws|walk|walks|wall|wall|way|well|wells|wl|wls|wy|xing|xrd|xrds';
//Temporarily remove mt. as a street end as it is more often part of a city
const streetNames = 'allee|alley|ally|aly|anex|annex|annx|anx|arc|arcade|av|ave|aven|avenu|avenue|avn|avnue|bayoo|bayou|bch|beach|bend|bg|bgs|blf|blfs|bluf|bluff|bluffs|blvd|bnd|bot|bottm|bottom|boul|boulevard|boulv|br|branch|brdge|brg|bridge|brk|brks|brnch|brook|brooks|btm|burg|burgs|byp|bypa|bypas|bypass|byps|byu|camp|canyn|canyon|cape|causeway|causwa|causway|cen|cent|center|centers|centr|centre|cir|circ|circl|circle|circles|cirs|ck|clb|clf|clfs|cliff|cliffs|club|cmn|cmns|cmp|cnter|cntr|cnyn|common|commons|cor|corner|corners|cors|course|court|courts|cove|coves|cp|cpe|cr|crcl|crcle|crecent|creek|cres|crescent|cresent|crest|crk|crossing|crossroad|crossroads|crscnt|crse|crsent|crsnt|crssing|crssng|crst|crt|cswy|ct|ctr|ctrs|cts|curv|curve|cv|cvs|cyn|dale|dam|div|divide|dl|dm|dr|driv|drive|drives|drs|drv|dv|dvd|est|estate|estates|ests|exp|expr|express|expressway|expw|expy|ext|extension|extensions|extn|extnsn|exts|fall|fall|falls|ferry|field|fields|fl|flat|flats|fld|flds|floor|fls|flt|flts|ford|fords|forest|forests|forg|forge|forges|fork|forks|fort|frd|frds|freeway|freewy|frg|frgs|frk|frks|frry|frst|frt|frway|frwy|fry|ft|fwy|garden|gardens|gardn|gateway|gatewy|gatway|gdn|gdns|glen|glens|gln|glns|grden|grdn|grdns|green|greens|grn|grns|grov|grove|groves|grv|grvs|gtway|gtwy|harb|harbor|harbors|harbr|haven|havn|hbr|hbrs|height|heights|hgts|highway|highwy|hill|hills|hiway|hiwy|hl|hllw|hls|hollow|hollows|holw|holws|hrbor|ht|hts|hvn|hway|hwy|inlet|inlt|is|island|islands|isle|isles|islnd|islnds|iss|jct|jction|jctn|jctns|jcts|junction|junctions|junctn|juncton|key|keys|knl|knls|knol|knoll|knolls|ky|kys|la|lake|lakes|land|land|landing|lane|lanes|lck|lcks|ldg|ldge|lf|lgt|lgts|light|lights|lk|lks|ln|lndg|lndng|loaf|lock|locks|lodg|lodge|loop|loops|mall|mall|manor|manors|mdw|mdws|meadow|meadows|medows|mews|mews|mill|mills|mission|missn|ml|mls|mnr|mnrs|motorway|msn|mssn|mtwy|nck|neck|opas|orch|orchard|orchrd|oval|overpass|ovl|park|parks|parkway|parkways|parkwy|pass|pass|passage|path|paths|pike|pikes|pine|pines|pk|pkway|pkwy|pkwys|pky|pl|place|plain|plaines|plains|plaza|pln|plns|plz|plza|pne|pnes|point|points|port|ports|pr|prairie|prarie|prk|prr|prt|prts|psge|pt|pts|rad|radial|radiel|radl|ranch|ranches|rapid|rapids|rd|rdg|rdge|rdgs|rds|rest|ridge|ridges|riv|river|rivr|rnch|rnchs|road|roads|route|row|row|rpd|rpds|rst|rte|rue|rue|run|run|rvr|shl|shls|shoal|shoals|shoar|shoars|shore|shores|shr|shrs|skwy|skyway|smt|spg|spgs|spng|spngs|spring|springs|sprng|sprngs|spur|spurs|sq|sqr|sqre|sqrs|sqs|squ|square|squares|st|sta|station|statn|stn|str|stra|strav|strave|straven|stravenue|stravn|stream|street|streets|streme|strm|strt|strvn|strvnue|sts|sumit|sumitt|summit|ter|terr|terrace|throughway|tpk|tpke|tr|trace|traces|track|tracks|trafficway|trail|trails|trak|trce|trfy|trk|trks|trl|trls|trnpk|trpk|trwy|tunel|tunl|tunls|tunnel|tunnels|tunnl|turnpike|turnpk|un|underpass|union|unions|uns|upas|valley|valleys|vally|vdct|via|viadct|viaduct|view|views|vill|villag|village|villages|ville|villg|villiage|vis|vist|vista|vl|vlg|vlgs|vlly|vly|vlys|vst|vsta|vw|vws|walk|walks|wall|wall|way|well|wells|wl|wls|wy|xing|xrd|xrds';
const states = 'AK|AL|AR|AS|AZ|CA|CO|CT|DC|DE|FL|FM|GA|GU|HI|IA|ID|IL|IN|KS|KY|LA|MA|MD|ME|MH|MI|MN|MO|MP|MS|MT|NC|ND|NE|NH|NJ|NM|NV|NY|OH|OK|OR|PA|PR|PW|RI|SC|SD|TN|TX|UT|VA|VI|VT|WA|WI|WV|WY|alabama|alaska|american samoa|arizona|arkansas|california|colorado|connecticut|delaware|district of columbia|federated states of micronesia|florida|georgia|guam|hawaii|idaho|illinois|indiana|iowa|kansas|kentucky|louisiana|maine|marshall islands|maryland|massachusetts|michigan|minnesota|mississippi|missouri|montana|nebraska|nevada|new hampshire|new jersey|new mexico|new york|north carolina|north dakota|northern mariana islands|ohio|oklahoma|oregon|palau|pennsylvania|puerto rico|rhode island|south carolina|south dakota|tennessee|texas|utah|vermont|virgin islands|virginia|washington|west virginia|wisconsin|wyoming';
const directions = 'north|northeast|east|southeast|south|southwest|west|northwest|n|ne|e|se|s|sw|w|nw';
//Easiest to understand right to left. Parse zip code first, then state, get the street by saying it ends at a road, what's left in the middle is the city.
const regex = new RegExp(`^\\s*([\\w\\s,\\.]+\\s+(?:[\\d]+|(?:${streetNames})(?:\\s+(?:${directions}))?|(?:${directions})\\s+[\\w\\.]+))[\\.,\\s]+([\\w\\s\\.]+)[\\.,\\s]+(${states})[\\.,\\s]+(\\d{5}(?:-\\d{4})?)\\s*$`, "i");
const doubleStreetAddress = new RegExp(`^.*(${streetNames})\\s+(${streetNames})$`,"i");
function parseAddress(address) {
    const match = address.match(regex);
    if (match) {
        var output = {
            address: match[1],
            city: match[2].trim(),
            state: match[3],
            zip: match[4]
        };
        // see if we accidentally thought part of the city was a street name
        var doubleStreetMatch = output.address.match(doubleStreetAddress);
        if (doubleStreetMatch) {
            // remove the second street name from the address
            output.address = output.address.replace(new RegExp(`${doubleStreetMatch[2]}$`,"i"), '').trim();
            // add the second street name to the city
            output.city = doubleStreetMatch[2] + ' ' + output.city;
        }
        return output;
    }
    return null;
}